(()=>{"use strict";var t="https://nomoreparties.co/v1/wff-cohort-4",e={authorization:"ce09f12f-de5e-4688-93af-602a37ede720","Content-Type":"application/json"};function n(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function o(t,e,n,o,r){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=i.querySelector(".card__delete-button"),a=i.querySelector(".card__like-button"),u=i.querySelector(".card__image"),s=i.querySelector(".card__title"),l=i.querySelector(".card__likes"),d=t._id;return u.addEventListener("click",o),a.addEventListener("click",(function(n){r(t,n,e)})),"https://nomoreparties.co/v1/wff-cohort-4/users/me"===t.link&&(t.link="https://proprikol.ru/wp-content/uploads/2020/11/kartinki-oshibki-31.jpg"),u.src=t.link,u.alt=t.name,s.textContent=t.name,l.textContent=t.likes.length,t.likes.some((function(t){return t._id===e}))&&a.classList.add("card__like-button_is-active"),t.owner._id!=e?c.remove():c.addEventListener("click",(function(t){n(d,t)})),i}function r(o,r,i){var c,a=o.likes.some((function(t){return t._id===i})),u=r.target.closest(".card__like-button"),s=r.target.closest(".card").querySelector(".card__likes");a?(c=o._id,fetch("".concat(t,"/cards/likes/").concat(c),{method:"DELETE",headers:{authorization:e.authorization,"Content-Type":"application/json"}}).then((function(t){return n(t)}))).then((function(t){u.classList.toggle("card__like-button_is-active"),s.textContent=t.likes.length,o.likes=t.likes})).catch((function(t){return console.log("Error: ",t)})):function(o){return fetch("".concat(t,"/cards/likes/").concat(o),{method:"PUT",headers:{authorization:e.authorization,"Content-Type":"application/json"}}).then((function(t){return n(t)}))}(o._id).then((function(t){u.classList.toggle("card__like-button_is-active"),s.textContent=t.likes.length,o.likes=t.likes})).catch((function(t){return console.log("Error: ",t)}))}function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function c(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&c(e)}}function u(t){t.target.classList.contains("popup_is-opened")&&c(t.currentTarget)}function s(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function l(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),n.forEach((function(n){s(t,n,e)}))}function d(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n.inactiveButtonClass):e.classList.add(n.inactiveButtonClass)}var p=document.querySelector(".places__list"),f=document.forms["edit-profile"],m=f.elements.name,_=f.elements.description,h=f.querySelector('button[type="submit"]'),v=document.forms["new-place"],y=v.elements["place-name"],S=v.elements.link,k=v.querySelector('button[type="submit"]'),E=document.forms["new-avatar"],b=E.elements.avatar,g=E.querySelector('button[type="submit"]'),q=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),z=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),x=document.querySelectorAll(".popup__close"),j=document.querySelectorAll(".popup"),w=document.querySelector(".popup_type_edit"),A=document.querySelector(".popup_type_new-card"),B=document.querySelector(".popup_type_image"),D=document.querySelector(".popup__type_avatar"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"};function N(t){var e=document.querySelector(".popup__image"),n=document.querySelector(".popup__caption");i(B),e.src=t.target.src,e.alt=t.target.alt,n.textContent=t.target.alt}function O(o,r){!function(o){fetch("".concat(t,"/cards/").concat(o),{method:"DELETE",headers:{authorization:e.authorization,"Content-Type":"application/json"}}).then((function(t){return n(t)}))}(o),r.target.closest(".card").remove()}function J(t){q.textContent=t.name,C.textContent=t.about,L.style.backgroundImage="url(".concat(t.avatar,")")}function H(t,e){e.textContent=t?"Сохранение...":"Сохранить"}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);d(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity("Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы."):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),d(n,o,e)}))}))}(e,t)}))}(P),j.forEach((function(t){t.addEventListener("click",u)})),x.forEach((function(t){t.addEventListener("click",(function(t){j.forEach((function(t){c(t)}))}))})),L.addEventListener("click",(function(){i(D)})),z.addEventListener("click",(function(){l(f,P),f.reset(),i(w),m.value=q.textContent,_.value=C.textContent})),T.addEventListener("click",(function(){v.reset(),l(v,P),i(A)})),L.addEventListener("click",(function(){E.reset(),l(E,P)})),f.addEventListener("submit",(function(o){var r;o.preventDefault(),H(!0,h),(r={name:f.name.value,about:f.description.value},fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:e.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:r.name,about:r.about})}).then((function(t){return n(t)}))).then((function(t){J(t),c(w)})).catch((function(t){return console.log(t)})).finally((function(){H(!1,h)}))})),v.addEventListener("submit",(function(i){var a;i.preventDefault(),H(!0,k),(a={name:y.value,link:S.value},fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:e.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:a.name,link:a.link})}).then((function(t){return n(t)}))).then((function(t){var e=t.owner._id;p.prepend(o(t,e,O,N,r)),c(A)})).catch((function(t){return console.log("Error: ",t)})).finally((function(){H(!1,k)}))})),E.addEventListener("submit",(function(o){var r;o.preventDefault(),H(!0,g),(r=b.value,fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).then((function(t){return n(t)}))).then((function(t){L.style.backgroundImage="url(".concat(t.avatar,")"),c(D)})).catch((function(t){return console.log("Error: ",t)})).finally((function(){H(!1,g)}))})),Promise.all([fetch("".concat(t,"/users/me"),{headers:{authorization:e.authorization}}).then((function(t){return n(t)})),fetch("".concat(t,"/cards"),{headers:{authorization:e.authorization}}).then((function(t){return n(t)}))]).then((function(t){var e,n,i=t[1],c=t[0];e=i,n=c._id,e.forEach((function(t){var e=o(t,n,O,N,r);p.append(e)})),J(c)}))})();