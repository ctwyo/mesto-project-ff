(()=>{"use strict";function t(t,e,n,r,c){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__delete-button"),u=i.querySelector(".card__like-button"),l=i.querySelector(".card__image"),s=i.querySelector(".card__title"),d=i.querySelector(".card__likes"),p=i.querySelector(".card__likes"),f=t._id;return i.id=t._id,l.addEventListener("click",(function(){return r(t.name,t.link)})),u.addEventListener("click",(function(){c(o(e,t),f,t,p,u)})),l.src=t.link,l.alt=t.name,s.textContent=t.name,d.textContent=t.likes.length,o(e,t)?u.classList.add("card__like-button_is-active"):u.classList.remove("card__like-button_is-active"),t.owner._id!=e?a.remove():a.addEventListener("click",(function(){n(t)})),i}var e=function(t){t.classList.toggle("card__like-button_is-active")};function n(t,n,o,r){o.textContent=n.length,t.likes=n,e(r)}function o(t,e){return e.likes.some((function(e){return e._id===t}))}function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function c(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&c(e)}}function a(t){t.target.classList.contains("popup_is-opened")&&c(t.currentTarget)}function u(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function l(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),n.forEach((function(n){u(t,n,e)}))}function s(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n.inactiveButtonClass):e.classList.add(n.inactiveButtonClass)}var d="https://nomoreparties.co/v1/wff-cohort-4",p={authorization:"ce09f12f-de5e-4688-93af-602a37ede720","Content-Type":"application/json"};function f(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}var m=document.querySelector(".places__list"),h=document.querySelector(".popup_type_edit"),_=document.forms["edit-profile"],v=_.elements.name,y=_.elements.description,S=_.querySelector('button[type="submit"]'),E=document.querySelector(".popup_type_new-card"),k=document.forms["new-place"],b=k.elements["place-name"],q=k.elements.link,C=k.querySelector('button[type="submit"]'),L=document.querySelector(".popup__type_avatar"),g=document.forms["new-avatar"],z=g.elements.avatar,T=g.querySelector('button[type="submit"]'),w=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),A=document.querySelector(".profile__image"),j=document.querySelector(".profile__edit-button"),B=document.querySelector(".profile__add-button"),D=document.querySelectorAll(".popup__close"),P=document.querySelectorAll(".popup"),I=document.querySelector(".popup_type_image"),N=I.querySelector(".popup__image"),O=I.querySelector(".popup__caption"),J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"};function H(t,e){r(I),N.src=e,N.alt=t,O.textContent=t}function M(t,e,o,r,c){return t?function(t){return fetch("".concat(d,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:p.authorization,"Content-Type":"application/json"}}).then((function(t){return f(t)}))}(e).then((function(t){n(o,t.likes,r,c)})).catch((function(t){return console.log("Error when delete like",t)})):function(t){return fetch("".concat(d,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:p.authorization,"Content-Type":"application/json"}}).then((function(t){return f(t)}))}(e).then((function(t){n(o,t.likes,r,c)})).catch((function(t){return console.log("Error when put like",t)}))}function V(t){var e;(e=t._id,fetch("".concat(d,"/cards/").concat(e),{method:"DELETE",headers:{authorization:p.authorization,"Content-Type":"application/json"}}).then((function(t){return f(t)}))).then((function(){!function(t){t.remove()}(document.getElementById(t._id))})).catch((function(t){return console.log("Error while delete card",t)}))}function U(t){w.textContent=t.name,x.textContent=t.about,A.style.backgroundImage="url(".concat(t.avatar,")")}function F(t,e){e.textContent=t?"Сохранение...":"Сохранить"}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);s(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity("Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы."):e.setCustomValidity(""),e.validity.valid?u(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),s(n,o,e)}))}))}(e,t)}))}(J),P.forEach((function(t){t.addEventListener("click",a)})),D.forEach((function(t){t.addEventListener("click",(function(t){P.forEach((function(t){c(t)}))}))})),A.addEventListener("click",(function(){r(L)})),j.addEventListener("click",(function(){l(_,J),_.reset(),r(h),v.value=w.textContent,y.value=x.textContent})),B.addEventListener("click",(function(){k.reset(),l(k,J),r(E)})),A.addEventListener("click",(function(){g.reset(),l(g,J)})),_.addEventListener("submit",(function(t){var e;t.preventDefault(),F(!0,S),(e={name:_.name.value,about:_.description.value},fetch("".concat(d,"/users/me"),{method:"PATCH",headers:{authorization:p.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((function(t){return f(t)}))).then((function(t){U(t),c(h)})).catch((function(t){return console.log(t)})).finally((function(){F(!1,S)}))})),k.addEventListener("submit",(function(e){var n;e.preventDefault(),F(!0,C),(n={name:b.value,link:q.value},fetch("".concat(d,"/cards"),{method:"POST",headers:{authorization:p.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:n.name,link:n.link})}).then((function(t){return f(t)}))).then((function(e){var n=e.owner._id;m.prepend(t(e,n,V,H,M)),c(E)})).catch((function(t){return console.log("Error: ",t)})).finally((function(){F(!1,C)}))})),g.addEventListener("submit",(function(t){var e;t.preventDefault(),F(!0,T),(e=z.value,fetch("".concat(d,"/users/me/avatar"),{method:"PATCH",headers:{authorization:p.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return f(t)}))).then((function(t){A.style.backgroundImage="url(".concat(t.avatar,")"),c(L)})).catch((function(t){return console.log("Error: ",t)})).finally((function(){F(!1,T)}))})),Promise.all([fetch("".concat(d,"/users/me"),{headers:{authorization:p.authorization}}).then((function(t){return f(t)})),fetch("".concat(d,"/cards"),{headers:{authorization:p.authorization}}).then((function(t){return f(t)}))]).then((function(e){var n,o,r=e[1],c=e[0];n=r,o=c._id,n.forEach((function(e){var n=t(e,o,V,H,M);m.append(n)})),U(c)})).catch((function(t){return console.log("Error while getInitialInfo",t)}))})();